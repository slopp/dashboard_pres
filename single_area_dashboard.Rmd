---
title: Current Conditions
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    theme: journal
    css: styles_dashboard.css
params:
  resort:
    label: "Select Resort:"
    input: select
    value: Abasin
    choices: !r source("utils.R"); . <- getKnownAreas(); .$resorts
---

```{r setup}
library(ggplot2)
source("utils.R")
library(jsonlite)
library(flexdashboard)
area <- getAreaData(params$resort)
weather <- getCurrentWeather(params$resort)
```


Summary {data-height=15}
----------

### {data-width=10} 
![](`r area$logo`)

### Last 48 Hours {data-width=30}
```{r}

valueBox(caption = area$secondarySurfaceCondition,
                 
         value = paste0(area$snowLast48Hours,'"'),
         icon="ion-ios-snowy")
```

### Base {data-width=20}

```{r} 

valueBox(value=paste0(area$avgBaseDepthMax, '"'), caption = "Base", color="warning", icon="fa-map-signs")
```

### Weather {data-width=30}

```{r} 
weather_icon <- mapDescIcon(weather$weather)
valueBox(caption=weather$weather, value =  weather$feelslike_string, icon=weather_icon, color="primary")
```


Charts {data-height=70}
------------

### Snow Forecast
```{r}
f <- data.frame(
    label=c("24 Hours", "48 Hours","72 Hours"),
    value = c(area$predictedSnowFall_24Hours,
              area$predictedSnowFall_48Hours,
              area$predictedSnowFall_72Hours),
    stringsAsFactors = FALSE
  )
f$value <- as.numeric(f$value)
ggplot(data=f) + geom_bar(aes(x=factor(1:3), y=value), stat="identity", fill = "#f4a34b") +
  scale_x_discrete(labels=f$label, breaks=1:3) +
  scale_y_continuous(limits=c(0, max(f$value))) + 
  xlab("") +
  ylab("")+
  theme_minimal() 
```

### Runs

```{r}
d <- data.frame(
  cur = c(area$openDownHillTrails, area$openDownHillLifts),
  max = c(area$maxOpenDownHillTrails, area$maxOpenDownHillLifts),
  pos = 1:2,
  stringsAsFactors = FALSE
)

d <- lapply(d, as.numeric)
d$labels <- c("Runs", "Lifts")
d$percent <- round((d$cur / d$max)*100, digits=0)
d$lab <- paste0(d$cur, "/", d$max, " ", d$percent, "%")
d$labloc <- d$percent+10
d$col <- ifelse(d$percent < 80, ifelse(d$percent < 50, 1, 2), 3)
d <- as.data.frame(d)
ggplot(d, aes(x=factor(pos))) + 
         geom_bar(aes(y=100), fill="lightgrey", stat="identity") +
         geom_bar(aes(y=percent, fill=factor(col)), stat="identity") + 
         geom_text(aes(y=labloc, label=lab)) +
  xlab("") + ylab("") +
  scale_x_discrete(labels=c("Trails", "Lifts")) +
  scale_y_continuous(labels=NULL, breaks = NULL, limits = c(0,110)) +
  scale_fill_manual(values=c("firebrick", "orange", "green"), guide=FALSE) +
  theme_minimal() +
  coord_flip()
```


Acknowledgement {data-height=2}
------------
![](sclogo.png) ![](wulogo.jpg) ![](rslogo.png) <br>
Data Courtesy of Snocountry and Weather Underground. Report by RStudio. <br>
Not to be used for commercial purposes.



